2026.1.4
交易习惯（逐条落实）
✅ 1H K线
✅ 不设置止损
✅ 20U × 20倍
✅ 固定 2% 止盈
✅ 出现信号立即开仓
✅ 不重复开单，直到止盈才允许下一单
✅ 允许无限扛单（无最大持仓时间）
✅ 支持多合约（自动按 symbol 分组）
✅ 控制台实时输出每一笔交易
✅ 最终汇总：
总交易次数
胜率
总盈利（USDT）
最大持仓时间（小时 & 天）
平均持仓时间（小时 & 天）


















逻辑2：大阳反包 当天大阴
（BIG_GREEN_THEN_RED_SHORT）
触发条件：
前一日大阳线反包（收盘价 > 开盘价 × 1.07）
当日收盘形成大阴线（收盘价 < 开盘价）
动作：开 空单

# ================= 逻辑 =================
def candle_down(c): return c['close'] < c['open']
def big_green(c, ratio): return c['close'] > c['open'] * ratio

# ================= 回测函数 =================
def backtest_symbol(df_s, ratio):
    trades = []
    n = len(df_s)
    for i in range(1, n-2):  # 最后一天不能开仓，所以减2
        prev = df_s.iloc[i-1]      # 前一天
        curr = df_s.iloc[i]        # 当天
        next_candle = df_s.iloc[i+1] # 第二天（开仓日）

        # 严格逻辑：前一天大阳 + 当天收阴 + 第二天收阴
        if big_green(prev, ratio) and candle_down(curr) and candle_down(next_candle):
            entry_price = next_candle["open"]
            entry_date = next_candle["date"]
            tp_price = entry_price * (1 - TP)


2026年1月1日回测情况
============================================================
📊 阈值 1.07 风险画像
触发次数: 10464
盈利次数: 10462 | 亏损次数: 2 | 胜率: 99.98%
最长持仓天数: 608 天
最大浮亏: 4123.02 USDT
累计净收益: 83383.88 USDT

============================================================
📊 阈值 1.08 风险画像
触发次数: 8565
盈利次数: 8563 | 亏损次数: 2 | 胜率: 99.98%
最长持仓天数: 608 天
最大浮亏: 4123.02 USDT
累计净收益: 68191.88 USDT

| 阈值   | 触发次数   | 胜率     | 最长持仓天数 | 最大浮亏(USDT) | 累计净收益(USDT) |
| ---- | ------ | ------ | ------ | ---------- | ----------- |
| 1.03 | 26,708 | 99.96% | 1,995  | 91,901     | 193,946     |
| 1.04 | 20,667 | 99.98% | 1,995  | 4,123      | 160,128     |
| 1.05 | 16,199 | 99.99% | 608    | 4,123      | 129,263     |
| 1.06 | 12,940 | 99.98% | 608    | 4,123      | 103,192     |
| 1.07 | 10,464 | 99.98% | 608    | 4,123      | 83,384      |
| 1.08 | 8,565  | 99.98% | 608    | 4,123      | 68,192      |
| 1.12 | 4,303  | 100%   | 18     | 750        | 34,424      |
| 1.16 | 2,388  | 100%   | 17     | 750        | 19,104      |
| 1.18 | 1,847  | 100%   | 17     | 750        | 14,776      |



