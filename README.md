20260112
| 策略                | 交易次数   | 胜率（2%收益概率） | 累计收益（USDT） | 最大浮亏（USDT） | 平均持仓（天） |
| ----------------- | ------ | ---------- | ---------- | ---------- | ------- |
| BIG_GREEN_RED_3%  | 24,840 | 99.66%     | 99,028.98  | 111,212.75 | 7.33    |
| BIG_GREEN_RED_5%  | 18,461 | 99.69%     | 98,978.74  | 46,978.04  | 6.97    |
| BIG_GREEN_RED_6%  | 15,833 | 99.67%     | 94,438.45  | 45,119.19  | 6.81    |
| BIG_GREEN_RED_8%  | 11,481 | 99.71%     | 73,583.99  | 45,119.19  | 6.47    |
| BIG_GREEN_RED_10% | 8,229  | 99.67%     | 57,731.98  | 45,119.19  | 6.80    |
| BIG_GREEN_RED_12% | 6,082  | 99.69%     | 41,942.18  | 45,119.19  | 6.91    |
| THREE_RED         | 18,191 | 99.05%     | 36,888.04  | 48,375.30  | 10.14   |
| ONE_UP_THREE_DOWN | 15,386 | 99.53%     | 25,682.39  | 48,375.30  | 10.05   |
| TWO_UP_ONE_DOWN   | 22,476 | 99.36%     | 76,312.86  | 111,212.75 | 8.65    |
| THREE_UP_ONE_DOWN | 13,262 | 99.67%     | 18,853.53  | 111,212.75 | 9.91    |



2026.1.8
有个严重的逻辑问题，就是按照100%的逻辑，根本不可能预测到当天收盘价，这只是数学的最优组合
入场时间 = 第 3 根 K 线的开盘价
决策依据 = 前 2 根 K 线已收盘的数据
完全不使用未来信息
| 类别   | 编号 | 名称       | 具体参数                                    | 方向    | trades | winrate | total_profit | max_dd | avg_hold | score(0~100) |
| ---- | -- | -------- | --------------------------------------- | ----- | ------ | ------- | ------------ | ------ | -------- | ------------ |
| 冲高失败 | S5 | S5_SHORT | 当天涨幅 > **8%**                           | SHORT | 25342  | 99.76   | 110722       | 52505  | 6.52     | 96.3         |
| 诱多失败 | S1 | S1_SHORT | 前一天收盘 > 开盘 × **1.05**，当天收阴              | SHORT | 28067  | 99.67   | 76157        | 90365  | 7.34     | 91.2         |
| 波动异常 | X4 | X4_SHORT | 当日振幅（高低差 / 开盘） > **5%**                 | SHORT | 280011 | 99.60   | 824370       | 140807 | 8.61     | 88.5         |
| 波动异常 | X2 | X2_SHORT | 当天跌幅 < **-3%**                          | SHORT | 96287  | 99.45   | 353231       | 140807 | 8.83     | 81.7         |
| 趋势回踩 | L5 | L5_LONG  | 连续 3 天收盘价逐日上涨                           | LONG  | 91796  | 97.06   | 147157       | 399.58 | 16.32    | 77.4         |
| 恐慌反弹 | L1 | L1_LONG  | 当天跌幅 < **-5%**                          | LONG  | 56595  | 97.40   | 75833        | 398.90 | 16.53    | 75.2         |
| 诱多失败 | S3 | S3_SHORT | 当天上影线长度 > 实体长度 × **2**                  | SHORT | 76310  | 99.04   | 90807        | 107373 | 12.94    | 72.1         |
| 诱多失败 | S4 | S4_SHORT | 连续 3 天收盘价逐日下降（C1>C2>C3）                 | SHORT | 91796  | 99.00   | 63248        | 140807 | 12.71    | 70.5         |
| 诱多失败 | S2 | S2_SHORT | 当天涨幅 > **10%**，当天成交量 > 前一天成交量 × **1.5** | SHORT | 9218   | 99.72   | 43720        | 39015  | 6.50     | 68.9         |
| 冲高失败 | S7 | S7_SHORT | 当天成交量 > 前一天成交量 × **2**                  | SHORT | 29795  | 99.07   | 32545        | 140807 | 12.24    | 67.8         |
| 恐慌反弹 | L2 | L2_LONG  | 下影线长度 > 当日实体长度                          | LONG  | 135272 | 96.67   | 4662         | 399.72 | 18.81    | 54.3         |
| 波动异常 | X3 | X3_LONG  | 当日振幅（高低差 / 开盘） < **1%**                 | LONG  | 1417   | 93.44   | 1281         | 395.71 | 172.57   | 41.5         |
| 恐慌反弹 | L4 | L4_LONG  | 当天开盘价 < 前一天最低价                          | LONG  | 14     | 100.00  | 112          | 182.96 | 18.93    | 40.2         |
| 冲高失败 | S6 | S6_SHORT | 上影线 > 实体 × **1.5** 且 当天涨幅 > **5%**      | SHORT | 1884   | 99.47   | -5296        | 46978  | 6.20     | 36.7         |
| 趋势回踩 | L8 | L8_LONG  | 当日阳线完全包住前一天小阴线                          | LONG  | 48064  | 96.47   | -40436       | 399.61 | 19.96    | 30.5         |
| 冲高失败 | S8 | S8_SHORT | 当天收盘价 > 前一天最高价                          | SHORT | 77863  | 99.29   | -51854       | 121736 | 12.02    | 28.4         |
| 恐慌反弹 | L3 | L3_LONG  | 连续 3 天收盘价逐日上涨（C1<C2<C3）                 | LONG  | 81987  | 96.08   | -110245      | 399.72 | 18.55    | 22.1         |
| 波动异常 | X1 | X1_LONG  | 当天涨幅 > **3%**                           | LONG  | 85254  | 96.25   | -110661      | 399.65 | 17.42    | 21.7         |
| 趋势回踩 | L6 | L6_LONG  | 前一天最低价 > 前前一天最低价（回踩不破）                  | LONG  | 190506 | 96.32   | -117666      | 399.72 | 19.13    | 20.3         |
| 趋势回踩 | L7 | L7_LONG  | 当天成交量 < 前一天成交量（缩量回调）                    | LONG  | 192993 | 96.39   | -121433      | 399.72 | 19.38    | 19.8         |



2026.1.4
交易习惯（逐条落实）
✅ 1H K线
✅ 不设置止损
✅ 20U × 20倍
✅ 固定 2% 止盈
✅ 出现信号立即开仓
✅ 不重复开单，直到止盈才允许下一单
✅ 允许无限扛单（无最大持仓时间）
✅ 支持多合约（自动按 symbol 分组）
✅ 控制台实时输出每一笔交易
✅ 最终汇总：
总交易次数
胜率
总盈利（USDT）
最大持仓时间（小时 & 天）
平均持仓时间（小时 & 天）


这个1H逻辑：单子太少，不过胜率特别高。
BASE_URL = "https://fapi.binance.com"
INTERVAL = "1h"
KLINE_LIMIT = 200
INVEST = 20
LEVERAGE = 20
TP = 0.02
# 最优参数
VOLUME_MULT = 1.2
LOOKBACK = 3
UPPER_SHADOW_RATIO = 1.5

















逻辑2：大阳反包 当天大阴
（BIG_GREEN_THEN_RED_SHORT）
触发条件：
前一日大阳线反包（收盘价 > 开盘价 × 1.07）
当日收盘形成大阴线（收盘价 < 开盘价）
动作：开 空单

# ================= 逻辑 =================
def candle_down(c): return c['close'] < c['open']
def big_green(c, ratio): return c['close'] > c['open'] * ratio

# ================= 回测函数 =================
def backtest_symbol(df_s, ratio):
    trades = []
    n = len(df_s)
    for i in range(1, n-2):  # 最后一天不能开仓，所以减2
        prev = df_s.iloc[i-1]      # 前一天
        curr = df_s.iloc[i]        # 当天
        next_candle = df_s.iloc[i+1] # 第二天（开仓日）

        # 严格逻辑：前一天大阳 + 当天收阴 + 第二天收阴
        if big_green(prev, ratio) and candle_down(curr) and candle_down(next_candle):
            entry_price = next_candle["open"]
            entry_date = next_candle["date"]
            tp_price = entry_price * (1 - TP)


2026年1月1日回测情况
============================================================
📊 阈值 1.07 风险画像
触发次数: 10464
盈利次数: 10462 | 亏损次数: 2 | 胜率: 99.98%
最长持仓天数: 608 天
最大浮亏: 4123.02 USDT
累计净收益: 83383.88 USDT

============================================================
📊 阈值 1.08 风险画像
触发次数: 8565
盈利次数: 8563 | 亏损次数: 2 | 胜率: 99.98%
最长持仓天数: 608 天
最大浮亏: 4123.02 USDT
累计净收益: 68191.88 USDT

| 阈值   | 触发次数   | 胜率     | 最长持仓天数 | 最大浮亏(USDT) | 累计净收益(USDT) |
| ---- | ------ | ------ | ------ | ---------- | ----------- |
| 1.03 | 26,708 | 99.96% | 1,995  | 91,901     | 193,946     |
| 1.04 | 20,667 | 99.98% | 1,995  | 4,123      | 160,128     |
| 1.05 | 16,199 | 99.99% | 608    | 4,123      | 129,263     |
| 1.06 | 12,940 | 99.98% | 608    | 4,123      | 103,192     |
| 1.07 | 10,464 | 99.98% | 608    | 4,123      | 83,384      |
| 1.08 | 8,565  | 99.98% | 608    | 4,123      | 68,192      |
| 1.12 | 4,303  | 100%   | 18     | 750        | 34,424      |
| 1.16 | 2,388  | 100%   | 17     | 750        | 19,104      |
| 1.18 | 1,847  | 100%   | 17     | 750        | 14,776      |



